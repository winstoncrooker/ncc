<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Genre | VinylVault</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { background:#0e0e0e; color:#fff; font-family:'Montserrat',sans-serif; }
    
    /* Controls Section */
    .controls-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px 40px 0 40px;
    }
    
    .search-bar {
      width: 100%;
      padding: 12px 20px;
      font-size: 1rem;
      border: 2px solid #333;
      border-radius: 8px;
      background: #1a1a1a;
      color: #fff;
      margin-bottom: 20px;
      font-family: 'Montserrat', sans-serif;
    }
    
    .search-bar:focus {
      outline: none;
      border-color: #1db954;
    }
    
    .search-bar::placeholder {
      color: #888;
    }
    
    .filters-sorts {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
      align-items: center;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .filter-group label {
      font-size: 0.85rem;
      color: #aaa;
      font-weight: 600;
    }
    
    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 2px solid #333;
      border-radius: 6px;
      background: #1a1a1a;
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9rem;
    }
    
    .filter-group select:focus,
    .filter-group input:focus {
      outline: none;
      border-color: #1db954;
    }
    
    .price-inputs {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .price-inputs input {
      width: 80px;
    }
    
    .price-inputs span {
      color: #888;
    }
    
    .clear-filters {
      padding: 8px 16px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      transition: background 0.3s;
      align-self: flex-end;
    }
    
    .clear-filters:hover {
      background: #1db954;
    }
    
    /* Filter animation */
    .gallery.filtering {
      opacity: 0.5;
      pointer-events: none;
    }
    
    .results-info {
      color: #1db954;
      font-size: 0.9rem;
      margin-bottom: 10px;
      text-align: center;
      font-weight: 600;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .gallery { 
      display: grid; 
      grid-template-columns: repeat(4, 1fr); 
      gap: 20px; 
      padding: 40px; 
      max-width: 1400px;
      margin: 0 auto;
    }
    .card { 
      position: relative; 
      cursor: pointer; 
      overflow: hidden; 
      border-radius: 10px;
      aspect-ratio: 1 / 1;
    }
    .card img { 
      width: 100%; 
      height: 100%;
      object-fit: cover;
      display: block; 
      transition: transform .3s; 
    }
    .card:hover img { transform:scale(1.1); opacity:0.8; }
    .overlay { 
      position:absolute; 
      bottom:0; 
      background:rgba(0,0,0,0.7); 
      width:100%; 
      padding:10px; 
      text-align:center; 
      font-weight:600; 
      color:#1db954; 
    }
    
    .overlay .price {
      font-size: 0.8rem;
      color: #fff;
      margin-top: 3px;
    }
    
    @media (max-width: 1200px) {
      .gallery { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 800px) {
      .controls-container {
        padding: 15px 20px 0 20px;
      }
      
      .filters-sorts {
        gap: 10px;
      }
      
      .filter-group {
        flex: 1 1 45%;
      }
      
      .gallery { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 15px;
        padding: 20px;
      }
    }
    @media (max-width: 480px) {
      .controls-container {
        padding: 15px 15px 0 15px;
      }
      
      .filter-group {
        flex: 1 1 100%;
      }
      
      .gallery { 
        grid-template-columns: 1fr; 
        gap: 15px;
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <nav id="mainNav">
    <button class="hamburger" id="hamburger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="nav-links" id="navLinks">
      <a href="index.html">Home</a>
      <a href="stats.html">üìä Stats</a>
      <a href="mycollection.html">üìù My Collection</a>
      <a href="genre.html?genre=rock">Rock</a>
      <a href="genre.html?genre=blues">Blues</a>
      <a href="genre.html?genre=metal">Metal</a>
      <a href="genre.html?genre=pop">Pop</a>
      <a href="genre.html?genre=jazz">Jazz</a>
      <a href="genre.html?genre=soul">Soul</a>
      <a href="genre.html?genre=funk">Funk</a>
      <a href="genre.html?genre=country">Country</a>
      <a href="genre.html?genre=hiphop">Hip-Hop</a>
      <a href="genre.html?genre=folk">Folk</a>
      <a href="genre.html?genre=classical">Classical</a>
      <a href="genre.html?genre=experimental">Experimental</a>
      <a href="genre.html?genre=comedy">Comedy</a>
    </div>
  </nav>

  <section>
    <h2 id="genreTitle"></h2>
    
    <!-- Search and Filter Controls -->
    <div class="controls-container">
      <input 
        type="text" 
        id="searchInput" 
        class="search-bar" 
        placeholder="Search by artist or album name..."
      >
      
      <div class="filters-sorts">
        <div class="filter-group">
          <label for="sortBy">Sort By</label>
          <select id="sortBy">
            <option value="artist-asc">Artist (A-Z)</option>
            <option value="artist-desc">Artist (Z-A)</option>
            <option value="album-asc">Album (A-Z)</option>
            <option value="album-desc">Album (Z-A)</option>
            <option value="price-asc">Price (Low-High)</option>
            <option value="price-desc">Price (High-Low)</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>Price Range</label>
          <div class="price-inputs">
            <input type="number" id="minPrice" placeholder="Min" min="0">
            <span>-</span>
            <input type="number" id="maxPrice" placeholder="Max" min="0">
          </div>
        </div>
        
        <button class="clear-filters" id="clearFilters">Clear Filters</button>
      </div>
      
      <div class="results-info" id="resultsInfo"></div>
    </div>
    
    <div class="gallery" id="gallery"></div>
  </section>

  <script src="utils.js"></script>
  <script src="record.js"></script>
  <script>
    // Utility functions
    function getRecordById(id) {
      return records.find(r => r.id === id);
    }

    function getRecordsByGenre(genre) {
      return records.filter(r => r.genre.toLowerCase() === genre.toLowerCase())
        .sort((a, b) => a.artist.localeCompare(b.artist));
    }

    function formatPrice(value) {
      if (value === null || value === undefined) return "N/A";
      return `$${value.toLocaleString()}`;
    }
  </script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const genre = params.get("genre") || "rock";
    document.getElementById("genreTitle").innerText = genre.toUpperCase() + " Collection";

    const container = document.getElementById("gallery");
    const searchInput = document.getElementById("searchInput");
    const sortBy = document.getElementById("sortBy");
    const minPrice = document.getElementById("minPrice");
    const maxPrice = document.getElementById("maxPrice");
    const clearFiltersBtn = document.getElementById("clearFilters");
    const resultsInfo = document.getElementById("resultsInfo");
    
    let allRecords = getRecordsByGenre(genre);
    let filteredRecords = [...allRecords];
    
    // Render albums
    function renderAlbums(records) {
      container.innerHTML = '';
      
      if (records.length === 0) {
        container.innerHTML = '<p style="grid-column: 1/-1; text-align:center; color:#888; padding:40px;">No albums found matching your criteria.</p>';
        resultsInfo.textContent = 'No results';
        return;
      }
      
      resultsInfo.textContent = `Showing ${records.length} of ${allRecords.length} albums`;
      
      records.forEach((rec, index) => {
        const card = document.createElement("div");
        card.className = "card";
        card.style.animationDelay = `${index * 0.05}s`;
        const imgSrc = rec.cover || `https://via.placeholder.com/300x300/1a1a1a/1db954?text=${encodeURIComponent(rec.artist + ' - ' + rec.album)}`;
        const priceDisplay = formatPrice(rec.price);
        
        card.innerHTML = `
          <img src="${imgSrc}" alt="${rec.album}">
          <div class="overlay">
            <div style="font-size:0.85rem; font-weight:700; color:#fff; margin-bottom:3px;">${rec.artist}</div>
            <div style="font-size:0.75rem;">${rec.album}</div>
            <div class="price">${priceDisplay}</div>
          </div>
        `;
        card.onclick = () => window.location = `album.html?id=${rec.id}&genre=${rec.genre}`;
        container.appendChild(card);
      });
    }
    
    // Apply filters and sorting
    function applyFiltersAndSort() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const sortValue = sortBy.value;
      const min = minPrice.value ? parseFloat(minPrice.value) : null;
      const max = maxPrice.value ? parseFloat(maxPrice.value) : null;
      
      // Filter by search term
      filteredRecords = allRecords.filter(rec => {
        const matchesSearch = !searchTerm || 
          rec.artist.toLowerCase().includes(searchTerm) || 
          rec.album.toLowerCase().includes(searchTerm);
        
        const matchesPrice = (!min || (rec.price !== null && rec.price >= min)) &&
                            (!max || (rec.price !== null && rec.price <= max));
        
        return matchesSearch && matchesPrice;
      });
      
      // Sort
      filteredRecords.sort((a, b) => {
        switch(sortValue) {
          case 'artist-asc':
            return a.artist.localeCompare(b.artist);
          case 'artist-desc':
            return b.artist.localeCompare(a.artist);
          case 'album-asc':
            return a.album.localeCompare(b.album);
          case 'album-desc':
            return b.album.localeCompare(a.album);
          case 'price-asc':
            if (a.price === null) return 1;
            if (b.price === null) return -1;
            return a.price - b.price;
          case 'price-desc':
            if (a.price === null) return 1;
            if (b.price === null) return -1;
            return b.price - a.price;
          default:
            return 0;
        }
      });
      
      renderAlbums(filteredRecords);
    }
    
    // Clear filters
    function clearFilters() {
      searchInput.value = '';
      sortBy.value = 'artist-asc';
      minPrice.value = '';
      maxPrice.value = '';
      applyFiltersAndSort();
    }
    
    // Event listeners
    searchInput.addEventListener('input', applyFiltersAndSort);
    sortBy.addEventListener('change', applyFiltersAndSort);
    minPrice.addEventListener('input', applyFiltersAndSort);
    maxPrice.addEventListener('input', applyFiltersAndSort);
    clearFiltersBtn.addEventListener('click', clearFilters);
    
    // Hamburger menu toggle
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('navLinks');
    
    if (hamburger && navLinks) {
      hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navLinks.classList.toggle('active');
        document.body.classList.toggle('menu-open');
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('nav')) {
          hamburger.classList.remove('active');
          navLinks.classList.remove('active');
          document.body.classList.remove('menu-open');
        }
      });
      
      // Close menu when clicking a link
      navLinks.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          hamburger.classList.remove('active');
          navLinks.classList.remove('active');
          document.body.classList.remove('menu-open');
        });
      });
    }
    
    // Initial render
    applyFiltersAndSort();
  </script>
</body>
</html>
